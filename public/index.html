<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🐟 魚池捕魚實驗</title>
<link rel="stylesheet" href="css/index.css">
</head>
<body>
<h1>🐟 魚池捕魚實驗</h1>
<div id="chooseRole">
  <div id="playerA-box">
    <h2>受試者（甲）</h2>
    <input type="text" id="roomCode" placeholder="請輸入房間代碼" maxlength="6" style="text-transform: uppercase;">
    <button onclick="joinA()">🎮 加入實驗</button>
    <p>請向實驗者索取房間代碼</p>
  </div>
  
  <div id="playerB-box">
    <h2>實驗者（乙）</h2>
    <input type="text" id="username" placeholder="帳號">
    <input type="password" id="password" placeholder="密碼">
    <button onclick="loginB()">🔬 建立實驗房間</button>
  </div>
</div>

<script>
function joinA() {
  const roomCode = document.getElementById('roomCode').value.trim().toUpperCase();
  if (!roomCode) return alert('⚠️ 請輸入房間代碼');
  if (roomCode.length !== 6) return alert('⚠️ 房間代碼應為6位英數字');
  
  window.location.href = `playerA.html?roomId=${roomCode}`;
}

function loginB() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  
  if (!username || !password) {
    return alert('⚠️ 請輸入帳號和密碼');
  }

  fetch('/login', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({username, password})
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      const roomId = generateRoomCode();
      window.location.href = `playerB.html?roomId=${roomId}`;
    } else {
      alert('❌ 登入失敗：帳號或密碼錯誤');
    }
  })
  .catch(err => {
    alert('⚠️ 連線錯誤，請檢查網路');
    console.error(err);
  });
}

function generateRoomCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code = '';
  for (let i = 0; i < 6; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}
</script>
</body>
</html>