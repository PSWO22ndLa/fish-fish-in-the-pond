<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>魚池實驗入口</title>
<link rel="stylesheet" href="css/index.css">
</head>
<body>
<h1>🐟 魚池捕魚實驗</h1>
<div id="chooseRole">
  <div id="playerA-box">
    <h2>受試者（甲）</h2>
    <input type="text" id="playerIdA" placeholder="請輸入您的編號">
    <button onclick="joinA()">🎮 開始遊戲</button>
  </div>
  
  <div id="playerB-box">
    <h2>實驗者（乙）</h2>
    <input type="text" id="username" placeholder="帳號">
    <input type="password" id="password" placeholder="密碼">
    <input type="text" id="playerIdB" placeholder="受試者編號">
    <button onclick="loginB()">🔬 登入並監控</button>
  </div>
</div>

<script>
// 甲方：直接使用編號作為房間號
function joinA() {
  const id = document.getElementById('playerIdA').value.trim();
  if (!id) return alert('請輸入編號');
  window.location.href = `playerA.html?roomId=${id}`;
}

// 乙方：登入後監控指定受試者
function loginB() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const roomId = document.getElementById('playerIdB').value.trim();
  
  if (!username || !password || !roomId) {
    return alert('⚠️ 請完整填寫所有欄位');
  }

  fetch('/login', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({username, password})
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      window.location.href = `playerB.html?roomId=${roomId}`;
    } else {
      alert('❌ 登入失敗：帳號或密碼錯誤');
    }
  })
  .catch(err => {
    alert('⚠️ 連線錯誤，請檢查網路');
    console.error(err);
  });
}
</script>
</body>
</html>